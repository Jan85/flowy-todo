<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowy Todo</title>
    <style>
        :root {
            --bg-page:    #ede9f6;
            --bg-card:    #ffffff;
            --text-title: #1e1b4b;
            --text-sub:   #a09ab8;
            --text-main:  #2d2d3a;
            --text-done:  #c0b8d8;
            --text-muted: #a09ab8;
            --shadow:     rgba(120, 100, 180, 0.10);
            --active-tab-bg:     #ffffff;
            --active-tab-shadow: rgba(120, 100, 180, 0.14);
        }

        [data-theme="dark"] {
            --bg-page:    #111118;
            --bg-card:    #1c1c28;
            --text-title: #e8e8f5;
            --text-sub:   #66668a;
            --text-main:  #d4d4e4;
            --text-done:  #55556a;
            --text-muted: #8888aa;
            --shadow:     rgba(0, 0, 0, 0.30);
            --active-tab-bg:     #252538;
            --active-tab-shadow: rgba(0, 0, 0, 0.25);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-page);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            transition: background 0.3s;
        }

        .app {
            width: 100%;
            max-width: 480px;
            padding: 28px 20px 48px;
            min-height: 100vh;
            overflow-y: auto;
        }

        /* ‚îÄ‚îÄ Top bar ‚îÄ‚îÄ */
        .topbar {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 12px;
        }

        .theme-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.3rem;
            color: var(--text-muted);
            padding: 4px;
            opacity: 0.75;
            transition: opacity 0.2s;
            line-height: 1;
        }

        .theme-btn:hover { opacity: 1; }

        /* ‚îÄ‚îÄ App header ‚îÄ‚îÄ */
        .app-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 28px;
            justify-content: center;
        }

        .logo-icon {
            width: 54px;
            height: 54px;
            background: linear-gradient(140deg, #b07cf8, #6366f1);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.32);
        }

        [data-theme="dark"] .logo-icon {
            background: linear-gradient(140deg, #c084fc, #818cf8);
            box-shadow: 0 4px 20px rgba(129, 140, 248, 0.35);
        }

        .logo-icon svg {
            width: 28px;
            height: 28px;
            stroke: #fff;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .header-text h1 {
            font-size: 1.85rem;
            font-weight: 700;
            color: var(--text-title);
            line-height: 1.1;
        }

        .header-text h1 .flowy {
            background: linear-gradient(135deg, #b07cf8, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        [data-theme="dark"] .header-text h1 .flowy {
            background: linear-gradient(135deg, #c084fc, #818cf8);
            -webkit-background-clip: text;
            background-clip: text;
        }

        .header-text p {
            color: var(--text-sub);
            font-size: 0.88rem;
            margin-top: 3px;
        }

        /* ‚îÄ‚îÄ Stats row ‚îÄ‚îÄ */
        .stats-row {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            flex: 1;
            background: var(--bg-card);
            border-radius: 18px;
            padding: 18px 10px;
            text-align: center;
            box-shadow: 0 2px 14px var(--shadow);
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 6px;
        }

        .stat-num.total  { color: #7c3aed; }
        .stat-num.inprog { color: #e8407a; }
        .stat-num.done   { color: #6366f1; }

        .stat-label {
            font-size: 0.72rem;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 0.01em;
        }

        /* ‚îÄ‚îÄ Add task card ‚îÄ‚îÄ */
        .add-task-card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 8px 8px 8px 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 14px var(--shadow);
            margin-bottom: 12px;
        }

        .add-task-card input[type="text"] {
            flex: 1;
            border: none;
            outline: none;
            font-size: 1rem;
            background: transparent;
            color: var(--text-main);
            font-family: inherit;
        }

        .add-task-card input::placeholder { color: var(--text-muted); }

        .add-btn {
            width: 42px;
            height: 42px;
            border-radius: 13px;
            background: linear-gradient(135deg, #6b7cf8, #b07cf8);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 3px 10px rgba(107, 124, 248, 0.45);
            transition: opacity 0.2s, transform 0.1s;
        }

        .add-btn:hover  { opacity: 0.9; transform: scale(1.05); }
        .add-btn:active { transform: scale(0.95); }

        .add-btn svg {
            width: 20px;
            height: 20px;
            stroke: #fff;
            stroke-width: 2.8;
            stroke-linecap: round;
            fill: none;
        }

        /* ‚îÄ‚îÄ Meta row ‚îÄ‚îÄ */
        .meta-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }

        .meta-row select,
        .meta-row input[type="date"] {
            flex: 1;
            padding: 9px 12px;
            border: none;
            border-radius: 13px;
            font-size: 0.88rem;
            font-family: inherit;
            outline: none;
            color: var(--text-main);
            background: var(--bg-card);
            box-shadow: 0 2px 10px var(--shadow);
            cursor: pointer;
            transition: box-shadow 0.2s;
            color-scheme: light dark;
        }

        .meta-row select:focus,
        .meta-row input[type="date"]:focus {
            box-shadow: 0 2px 14px rgba(99, 102, 241, 0.22);
        }

        /* ‚îÄ‚îÄ Sort row ‚îÄ‚îÄ */
        .sort-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .sort-row label {
            font-size: 0.82rem;
            color: var(--text-muted);
            white-space: nowrap;
        }

        .sort-row select {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 13px;
            font-size: 0.85rem;
            font-family: inherit;
            outline: none;
            color: var(--text-main);
            background: var(--bg-card);
            box-shadow: 0 2px 10px var(--shadow);
            cursor: pointer;
            transition: box-shadow 0.2s;
        }

        .sort-row select:focus {
            box-shadow: 0 2px 14px rgba(99, 102, 241, 0.22);
        }

        /* ‚îÄ‚îÄ Filter tabs ‚îÄ‚îÄ */
        .filter-card {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 6px;
            display: flex;
            gap: 4px;
            box-shadow: 0 2px 14px var(--shadow);
            margin-bottom: 20px;
        }

        .filter-tab {
            flex: 1;
            padding: 10px 0;
            border: none;
            border-radius: 13px;
            background: transparent;
            font-size: 0.93rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .filter-tab.active {
            background: var(--active-tab-bg);
            color: #7c3aed;
            box-shadow: 0 2px 8px var(--active-tab-shadow);
            font-weight: 600;
        }

        /* ‚îÄ‚îÄ Task list ‚îÄ‚îÄ */
        .todo-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .todo-item {
            background: var(--bg-card);
            border-radius: 18px;
            padding: 16px 14px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 2px 14px var(--shadow);
            animation: slideIn 0.2s ease;
        }

        .todo-item.overdue {
            box-shadow: 0 2px 14px var(--shadow), inset 3px 0 0 #e8407a;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-6px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* Custom circle checkbox */
        .task-check {
            appearance: none;
            -webkit-appearance: none;
            width: 26px;
            height: 26px;
            border: 2.5px solid #d4c8f0;
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        [data-theme="dark"] .task-check { border-color: #44446a; }

        .task-check:checked {
            background: linear-gradient(135deg, #6b7cf8, #b07cf8);
            border-color: transparent;
        }

        .task-check:checked::after {
            content: '';
            position: absolute;
            left: 7px;
            top: 3px;
            width: 6px;
            height: 11px;
            border: 2.5px solid #fff;
            border-top: none;
            border-left: none;
            transform: rotate(45deg);
        }

        .todo-content {
            flex: 1;
            min-width: 0;
        }

        .todo-text {
            font-size: 0.98rem;
            font-weight: 600;
            color: var(--text-main);
            word-break: break-word;
            display: block;
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .todo-text.completed {
            text-decoration: line-through;
            color: var(--text-done);
            font-weight: 400;
        }

        .task-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Priority badges */
        .priority-badge {
            display: inline-block;
            font-size: 0.73rem;
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 20px;
            letter-spacing: 0.01em;
        }

        .priority-high   { background: #fee2e2; color: #b91c1c; }
        .priority-medium { background: #fef3c7; color: #92400e; }
        .priority-low    { background: #dcfce7; color: #166534; }

        [data-theme="dark"] .priority-high   { background: #3d1010; color: #fca5a5; }
        [data-theme="dark"] .priority-medium { background: #3d2e00; color: #fcd34d; }
        [data-theme="dark"] .priority-low    { background: #0f2d18; color: #86efac; }

        /* Due date badge */
        .due-badge {
            display: inline-block;
            font-size: 0.73rem;
            font-weight: 500;
            padding: 3px 10px;
            border-radius: 20px;
            background: #e0f2fe;
            color: #0284c7;
        }

        .due-badge.overdue {
            background: #fee2e2;
            color: #b91c1c;
        }

        [data-theme="dark"] .due-badge         { background: #0c2a3a; color: #7dd3fc; }
        [data-theme="dark"] .due-badge.overdue { background: #3d1010; color: #fca5a5; }

        .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #d4c8f0;
            font-size: 0.9rem;
            padding: 6px;
            border-radius: 8px;
            flex-shrink: 0;
            line-height: 1;
            transition: color 0.2s, background 0.2s;
        }

        [data-theme="dark"] .delete-btn { color: #44446a; }

        .delete-btn:hover {
            color: #e8407a;
            background: rgba(232, 64, 122, 0.08);
        }

        .empty-state {
            text-align: center;
            padding: 48px 0 32px;
            color: var(--text-muted);
            font-size: 0.95rem;
            list-style: none;
        }

        /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
        .footer {
            margin-top: 24px;
            display: flex;
            justify-content: center;
        }

        .clear-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.85rem;
            font-family: inherit;
            padding: 8px 20px;
            border-radius: 12px;
            transition: color 0.2s, background 0.2s;
        }

        .clear-btn:hover {
            color: #e8407a;
            background: rgba(232, 64, 122, 0.07);
        }

        @media (max-width: 480px) {
            .app { padding: 20px 14px 40px; }
        }
    </style>
</head>
<body>
    <div class="app">

        <!-- Top bar -->
        <div class="topbar">
            <button class="theme-btn" id="themeToggle" onclick="toggleTheme()" title="Toggle dark mode">üåê</button>
        </div>

        <!-- Header -->
        <div class="app-header">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <div class="header-text">
                <h1><span class="flowy">Flowy</span> Todo</h1>
                <p>Organize your day effortlessly</p>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-num total" id="statTotal">0</div>
                <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat-card">
                <div class="stat-num inprog" id="statActive">0</div>
                <div class="stat-label">In Progress</div>
            </div>
            <div class="stat-card">
                <div class="stat-num done" id="statDone">0</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>

        <!-- Add task -->
        <div class="add-task-card">
            <input type="text" id="todo-input" placeholder="Add a new task..." />
            <button class="add-btn" id="add-btn" title="Add task">
                <svg viewBox="0 0 24 24">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </button>
        </div>

        <!-- Meta -->
        <div class="meta-row">
            <select id="priority">
                <option value="low">Low priority</option>
                <option value="medium" selected>Medium priority</option>
                <option value="high">High priority</option>
            </select>
            <input type="date" id="due-date" />
        </div>

        <!-- Sort -->
        <div class="sort-row">
            <label for="sort-by">Sort by:</label>
            <select id="sort-by">
                <option value="priority">Priority</option>
                <option value="dueDate">Due Date</option>
                <option value="created">Date Added</option>
            </select>
        </div>

        <!-- Filter tabs -->
        <div class="filter-card">
            <button class="filter-tab active" data-filter="all">All</button>
            <button class="filter-tab" data-filter="active">Active</button>
            <button class="filter-tab" data-filter="completed">Done</button>
        </div>

        <!-- Task list -->
        <ul class="todo-list" id="todo-list"></ul>

        <!-- Footer -->
        <div class="footer">
            <button class="clear-btn" onclick="clearCompleted()">Clear completed</button>
        </div>

    </div>

    <script>
        // ‚îÄ‚îÄ Theme ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        (function () {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (saved ? saved === 'dark' : prefersDark) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();

        function toggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            if (isDark) {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const todoInput    = document.getElementById('todo-input');
        const dueDateInput = document.getElementById('due-date');
        const priorityInput = document.getElementById('priority');
        const todoList     = document.getElementById('todo-list');
        const filterBtns   = document.querySelectorAll('.filter-tab');
        const sortSelect   = document.getElementById('sort-by');

        let currentFilter = 'all';
        let currentSort   = 'priority';
        let todos = JSON.parse(localStorage.getItem('todos')) || [];

        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
            updateStats();
        }

        function updateStats() {
            const completed = todos.filter(t => t.completed).length;
            const total     = todos.length;
            document.getElementById('statTotal').textContent  = total;
            document.getElementById('statActive').textContent = total - completed;
            document.getElementById('statDone').textContent   = completed;
        }

        function isOverdue(dueDate) {
            if (!dueDate) return false;
            const today = new Date(); today.setHours(0,0,0,0);
            return new Date(dueDate) < today;
        }

        function sortTodos(arr) {
            const order = { high: 0, medium: 1, low: 2 };
            return [...arr].sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                if (currentSort === 'priority') {
                    const diff = (order[a.priority] ?? 1) - (order[b.priority] ?? 1);
                    if (diff !== 0) return diff;
                    if (a.dueDate && b.dueDate) return new Date(a.dueDate) - new Date(b.dueDate);
                    if (a.dueDate) return -1;
                    if (b.dueDate) return  1;
                } else if (currentSort === 'dueDate') {
                    if (a.dueDate && b.dueDate) return new Date(a.dueDate) - new Date(b.dueDate);
                    if (a.dueDate) return -1;
                    if (b.dueDate) return  1;
                } else if (currentSort === 'created') {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                }
                return 0;
            });
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date     = new Date(dateStr);
            const today    = new Date(); today.setHours(0,0,0,0);
            const tomorrow = new Date(today); tomorrow.setDate(tomorrow.getDate() + 1);
            date.setHours(0,0,0,0);
            if (date.getTime() === today.getTime())    return 'Today';
            if (date.getTime() === tomorrow.getTime()) return 'Tomorrow';
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function escapeHtml(s) {
            return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
                     .replace(/"/g,'&quot;').replace(/'/g,'&#39;');
        }

        function renderTodos() {
            let filtered = todos;
            if (currentFilter === 'active')    filtered = todos.filter(t => !t.completed);
            if (currentFilter === 'completed') filtered = todos.filter(t =>  t.completed);

            const sorted = sortTodos(filtered);

            if (sorted.length === 0) {
                todoList.innerHTML = `<li class="empty-state">No tasks here.</li>`;
                updateStats();
                return;
            }

            todoList.innerHTML = sorted.map(todo => {
                const idx      = todos.indexOf(todo);
                const overdue  = !todo.completed && isOverdue(todo.dueDate);
                const priLabel = { high: 'High', medium: 'Medium', low: 'Low' }[todo.priority] || 'Medium';
                const dueBadge = todo.dueDate
                    ? `<span class="due-badge ${overdue ? 'overdue' : ''}">üìÖ ${formatDate(todo.dueDate)}</span>`
                    : '';
                return `
                <li class="todo-item ${overdue ? 'overdue' : ''}">
                    <input type="checkbox" class="task-check" ${todo.completed ? 'checked' : ''}
                        onchange="toggleTodo(${idx})" />
                    <div class="todo-content">
                        <span class="todo-text ${todo.completed ? 'completed' : ''}">${escapeHtml(todo.text)}</span>
                        <div class="task-meta">
                            <span class="priority-badge priority-${todo.priority}">${priLabel}</span>
                            ${dueBadge}
                        </div>
                    </div>
                    <button class="delete-btn" onclick="deleteTodo(${idx})" title="Delete">&#10005;</button>
                </li>`;
            }).join('');

            updateStats();
        }

        function addTodo() {
            const text = todoInput.value.trim();
            if (!text) return;
            todos.push({
                text,
                completed: false,
                dueDate:   dueDateInput.value || null,
                priority:  priorityInput.value,
                createdAt: new Date().toISOString()
            });
            todoInput.value      = '';
            dueDateInput.value   = '';
            priorityInput.value  = 'medium';
            saveTodos();
            renderTodos();
        }

        function toggleTodo(index) {
            todos[index].completed = !todos[index].completed;
            saveTodos(); renderTodos();
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            saveTodos(); renderTodos();
        }

        function clearCompleted() {
            todos = todos.filter(t => !t.completed);
            saveTodos(); renderTodos();
        }

        function setFilter(filter) {
            currentFilter = filter;
            filterBtns.forEach(btn =>
                btn.classList.toggle('active', btn.dataset.filter === filter)
            );
            renderTodos();
        }

        // ‚îÄ‚îÄ Event listeners ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.getElementById('add-btn').addEventListener('click', addTodo);
        todoInput.addEventListener('keypress', e => { if (e.key === 'Enter') addTodo(); });
        filterBtns.forEach(btn => btn.addEventListener('click', () => setFilter(btn.dataset.filter)));
        sortSelect.addEventListener('change', e => { currentSort = e.target.value; renderTodos(); });

        const today = new Date().toISOString().split('T')[0];
        dueDateInput.setAttribute('min', today);

        renderTodos();
    </script>
</body>
</html>
